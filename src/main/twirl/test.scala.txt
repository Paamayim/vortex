@import spire.math._; var r: Double = 0; var theta: Double = 0; var p: Double = 0

@preamble("PHYS 234 - A3")

@problem1(re: Int, im: Int) = {
    @{r = roundAt(2, sqrt(re*re + im*im))}
    @{theta = roundAt(3, scala.math.atan2(im, re))}
    \problemsub
    \begin{align*}
    z &= @re + @im i \\
    \\
    r &= ||z|| \\
      &= @r \\
    \\
    \theta &= \arctan\frac{\Im}{\Re}(z) \biggr \rvert_{z = @re + @im i} \\
           &= @unit(theta, "rad")
    \\
    z &= @r (\cos{@theta} + i\sin{@theta}) \\
    &= @r e^{@theta i}
    \end{align*}
}

@problem2(i: Int, up: Complex[Double], down: Complex[Double]) = {
    \begin{align*}
        r &= \sqrt{|@up|^2 + |@down|^2} \\
          &= @r \\
        \\
        \Ket{\psi_{@i,norm}} &= \frac{\Ket{\psi_@i}}{r} \\
                             &= \frac{@up}{@r}\Ket{+} + \frac{@down}{@r}\Ket{-}
        \\
        P_z &= |\Braket{+|\psi_{@i,norm}}|^2 \\
            &= \left|\frac{@up}{@r}\right|^2 \\
            &= @p \\
        \\
        P_x &= \left|\frac{1}{\sqrt{2}}
            (\Bra{+} + \Bra{-})\Ket{\psi_{@i,norm}}\right|^2 \\
            &= \left|\frac{1}{\sqrt{2}}
            (\Braket{+|\psi_{@i,norm}} + \Braket{-|\psi_{@i,norm}})\right|^2 \\
            &= @p \\
        \\
    \end{align*}

}

@for(z <- List((-3, 4), (7, -1), (-2, -5))) {
    @problem1(z._1, z._2)
}

\stepcounter{set}
@problem2(1, 3, 4)


\end{document}
